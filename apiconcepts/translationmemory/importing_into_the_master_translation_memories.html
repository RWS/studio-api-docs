<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Importing into the Master Translation Memories </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Importing into the Master Translation Memories ">
    <meta name="generator" content="docfx 2.58.9.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <span class="glyphicon glyphicon-search search-icon"></span>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar-default">
          <div class="container hide-when-search">
            <div class="breadcrumb-container" id="breadcrumb">
              <ul class="breadcrumb col-md-10">
                <li></li>
              </ul>
            </div>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="importing-into-the-master-translation-memories">Importing into the Master Translation Memories</h1>

<p>The application is required to merge multiple *.tmx files of the same language direction into one master TM. If the master TM with the required language direction does not exist, the application needs to create one before it starts the import.</p>
<h2 id="add-a-new-class">Add a New Class</h2>
<p>Start by adding a class called <code>TmImport</code>. The main purpose of this class is to import the *.tmx files into master TMs and to trigger a separate function for creating the master TMs with the corresponding language direction if they are not yet available.</p>
<p>Implement a public function called <code>Import</code>, which takes the *.tmx file name and path as parameter. Like the export functionality, this function, too, is called from the <code>ProcessDir</code> function of the <code>TmIterator</code> class (see <a href="looping_through_the_folders.html">Looping through the Folder(s)</a>).</p>
<h2 id="create-the-master-tm-path">Create the Master TM Path</h2>
<p>In the next step, set up the path in which the master TMs should be created. To keep this implementation as simple as possible, we will just hard-code the path name. The path should only be created when it does not yet exist:</p>
<div class="tabGroup" id="tabgroup_kAXHQlzIKF">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_kAXHQlzIKF_tabid-1" role="tab" aria-controls="tabpanel_kAXHQlzIKF_tabid-1" data-tab="tabid-1" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_kAXHQlzIKF_tabid-1" role="tabpanel" data-tab="tabid-1">
<pre><code class="lang-cs">// Create the path in which the master TMs should be
// stored (if the path does not exist yet).
string masterPath = @&quot;c:\MasterTMs\&quot;;
if (!System.IO.Directory.Exists(masterPath))
{
    System.IO.Directory.CreateDirectory(masterPath);
}
</code></pre></section>
</div>
<h2 id="determine-the-language-direction">Determine the Language Direction</h2>
<p>When generating the *.tmx files we appended the language direction to the TM file names, so that we can retrieve this information for creating and naming the master TMs accordingly. Start by parsing the file name string to retrieve the language direction information. To determine the language direction we use the XML DOM API. Below you see an example of a translation unit in TMX format:</p>
<div class="tabGroup" id="tabgroup_kAXHQlzIKF-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_kAXHQlzIKF-1_tabid-2" role="tab" aria-controls="tabpanel_kAXHQlzIKF-1_tabid-2" data-tab="tabid-2" tabindex="0" aria-selected="true">XML</a>
</li>
</ul>
<section id="tabpanel_kAXHQlzIKF-1_tabid-2" role="tabpanel" data-tab="tabid-2">
<pre><code class="lang-xml">&lt;tu creationdate=&quot;20090504T230613Z&quot; creationid=&quot;PEGASUS\Ziad&quot; changedate=&quot;20100507T224806Z&quot; changeid=&quot;PEGASUS\Administrator&quot; lastusagedate=&quot;20100507T224806Z&quot; usagecount=&quot;4&quot;&gt;
  &lt;prop type=&quot;x-Context&quot;&gt;0, 0&lt;/prop&gt;
  &lt;prop type=&quot;x-Origin&quot;&gt;TM&lt;/prop&gt;
  &lt;prop type=&quot;x-Customer:MultiplePicklist&quot;&gt;Microsoft&lt;/prop&gt;
  &lt;tuv xml:lang=&quot;en-US&quot;&gt;
    &lt;seg&gt;The Check Spelling Command&lt;/seg&gt;
  &lt;/tuv&gt;
  &lt;tuv xml:lang=&quot;de-DE&quot;&gt;
    &lt;seg&gt;Der Befehl Rechtschreibung&lt;/seg&gt;
  &lt;/tuv&gt;
&lt;/tu&gt;
</code></pre></section>
</div>
<p>The source/target language locales can be retrieved from the lang attributes of the tuv elements inside the tu nodes. For our implementation we make the following assumptions about the *.tmx files :</p>
<ul>
<li>the files are all bilingual</li>
<li>each file contains at least one TU</li>
<li>all TUs in one *.tmx file have the same source/target language locales</li>
</ul>
<p>We therefore proceed as follows: We select the first tu element, and then retrieve the values of the <code>lang</code> attributes of the first (i.e. the source) <code>tuv</code>, and then the second (i.e. the target) <code>tuv</code> element:</p>
<div class="tabGroup" id="tabgroup_kAXHQlzIKF-2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_kAXHQlzIKF-2_tabid-3" role="tab" aria-controls="tabpanel_kAXHQlzIKF-2_tabid-3" data-tab="tabid-3" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_kAXHQlzIKF-2_tabid-3" role="tabpanel" data-tab="tabid-3">
<pre><code class="lang-cs">// Retrieve the language direction of the current TM
// by reading the appropriate lang values from the first
// tu element.
string srcLang = string.Empty;
string trgLang = string.Empty;
XmlDocument xmlDoc = new XmlDocument();
xmlDoc.Load(tmxPath);

try
{
    XmlNode tu = xmlDoc.SelectNodes(&quot;tmx/body/tu&quot;)[0];
    srcLang = tu.SelectNodes(&quot;tuv&quot;)[0].Attributes[0].Value;
    trgLang = tu.SelectNodes(&quot;tuv&quot;)[1].Attributes[0].Value;
}
catch
{
    // TU count is zero, i.e. no TM content to import
    Console.WriteLine(tmxPath + &quot; is empty, no content to import.&quot;);
}
</code></pre></section>
</div>
<h2 id="create-the-master-tms">Create the Master TMs</h2>
<p>Next, check whether a master TM for the language direction of the current *.tmx file already exists. If this is not the case, a separate function should be called to create the TM (see <a href="creating_the_master_translation_memories.html">Creating the Master Translation Memories</a>.</p>
<div class="tabGroup" id="tabgroup_kAXHQlzIKF-3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_kAXHQlzIKF-3_tabid-4" role="tab" aria-controls="tabpanel_kAXHQlzIKF-3_tabid-4" data-tab="tabid-4" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_kAXHQlzIKF-3_tabid-4" role="tabpanel" data-tab="tabid-4">
<pre><code class="lang-cs">// Check whether a master TM with the language direction found in the 
// current TMX file already exists. If not, then create the TM.
string translationMemoryPath = string.Format(&quot;{0}MasterTM_{1}_{2}.sdltm&quot;, masterPath, srcLang, trgLang);
if (!System.IO.File.Exists(translationMemoryPath))
{
    TMCreator create = new TMCreator();
    create.CreateMasterTm(srcLang, trgLang, masterPath);
}
</code></pre></section>
</div>
<h2 id="process-the-import">Process the Import</h2>
<p>Now import the given *.tmx file into the master TM:</p>
<div class="tabGroup" id="tabgroup_kAXHQlzIKF-4">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_kAXHQlzIKF-4_tabid-5" role="tab" aria-controls="tabpanel_kAXHQlzIKF-4_tabid-5" data-tab="tabid-5" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_kAXHQlzIKF-4_tabid-5" role="tabpanel" data-tab="tabid-5">
<pre><code class="lang-cs">// Open the appropriate master TM and do the import.
FileBasedTranslationMemory tm = new FileBasedTranslationMemory(translationMemoryPath);
TranslationMemoryImporter importer = new TranslationMemoryImporter(tm.LanguageDirection);
this.GetImportSettings(importer.ImportSettings);
importer.Import(tmxPath);
</code></pre></section>
</div>
<p>Note that at this point we call a separate function to configure the import settings.</p>
<div class="tabGroup" id="tabgroup_kAXHQlzIKF-5">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_kAXHQlzIKF-5_tabid-6" role="tab" aria-controls="tabpanel_kAXHQlzIKF-5_tabid-6" data-tab="tabid-6" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_kAXHQlzIKF-5_tabid-6" role="tabpanel" data-tab="tabid-6">
<pre><code class="lang-cs">/// &lt;summary&gt;
///  Configure the import settings.
/// &lt;/summary&gt;
/// &lt;param name=&quot;importSettings&quot;&gt;Group of settings that control way of import.&lt;/param&gt;
private void GetImportSettings(ImportSettings importSettings)
{
    importSettings.CheckMatchingSublanguages = true;
    importSettings.ExistingFieldsUpdateMode = ImportSettings.FieldUpdateMode.Merge;
    importSettings.ExistingTUsUpdateMode = ImportSettings.TUUpdateMode.Overwrite;
}
</code></pre></section>
</div>
<p>For more information on the import functionality and possible settings, please refer to <a href="importing_a_tmx_file.html">Importing a TMX File</a>.</p>
<h2 id="putting-it-all-together">Putting it All Together</h2>
<p>The complete class should look as shown below:</p>
<div class="tabGroup" id="tabgroup_kAXHQlzIKF-6">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_kAXHQlzIKF-6_tabid-7" role="tab" aria-controls="tabpanel_kAXHQlzIKF-6_tabid-7" data-tab="tabid-7" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_kAXHQlzIKF-6_tabid-7" role="tabpanel" data-tab="tabid-7">
<pre><code class="lang-cs">namespace SDK.LanguagePlatform.Samples.BatchImporter
{
    using System;
    using System.Xml;
    using Sdl.LanguagePlatform.TranslationMemory;
    using Sdl.LanguagePlatform.TranslationMemoryApi;

    /// &lt;summary&gt;
    /// Represents functionality for emporting *.tmx files into translation memory.
    /// &lt;/summary&gt;
    public class TMImporter
    {
        #region &quot;ImportTmx&quot;

        /// &lt;summary&gt;
        /// This function performs the actual TMX import into the appropriate master TM.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tmxPath&quot;&gt;Path to *.tmx file.&lt;/param&gt;
        public void Import(string tmxPath)
        {
            #region &quot;CreatePath&quot;
            // Create the path in which the master TMs should be
            // stored (if the path does not exist yet).
            string masterPath = @&quot;c:\MasterTMs\&quot;;
            if (!System.IO.Directory.Exists(masterPath))
            {
                System.IO.Directory.CreateDirectory(masterPath);
            }
            #endregion

            #region &quot;GetLanguageDirection&quot;
            // Retrieve the language direction of the current TM
            // by reading the appropriate lang values from the first
            // tu element.
            string srcLang = string.Empty;
            string trgLang = string.Empty;
            XmlDocument xmlDoc = new XmlDocument();
            xmlDoc.Load(tmxPath);

            try
            {
                XmlNode tu = xmlDoc.SelectNodes(&quot;tmx/body/tu&quot;)[0];
                srcLang = tu.SelectNodes(&quot;tuv&quot;)[0].Attributes[0].Value;
                trgLang = tu.SelectNodes(&quot;tuv&quot;)[1].Attributes[0].Value;
            }
            catch
            {
                // TU count is zero, i.e. no TM content to import
                Console.WriteLine(tmxPath + &quot; is empty, no content to import.&quot;);
            }
            #endregion

            #region &quot;CheckMasterTmExists&quot;
            // Check whether a master TM with the language direction found in the 
            // current TMX file already exists. If not, then create the TM.
            string translationMemoryPath = string.Format(&quot;{0}MasterTM_{1}_{2}.sdltm&quot;, masterPath, srcLang, trgLang);
            if (!System.IO.File.Exists(translationMemoryPath))
            {
                TMCreator create = new TMCreator();
                create.CreateMasterTm(srcLang, trgLang, masterPath);
            }
            #endregion

            #region &quot;DoImport&quot;
            // Open the appropriate master TM and do the import.
            FileBasedTranslationMemory tm = new FileBasedTranslationMemory(translationMemoryPath);
            TranslationMemoryImporter importer = new TranslationMemoryImporter(tm.LanguageDirection);
            this.GetImportSettings(importer.ImportSettings);
            importer.Import(tmxPath);
            #endregion
        }
        #endregion

        #region &quot;settings&quot;

        /// &lt;summary&gt;
        ///  Configure the import settings.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;importSettings&quot;&gt;Group of settings that control way of import.&lt;/param&gt;
        private void GetImportSettings(ImportSettings importSettings)
        {
            importSettings.CheckMatchingSublanguages = true;
            importSettings.ExistingFieldsUpdateMode = ImportSettings.FieldUpdateMode.Merge;
            importSettings.ExistingTUsUpdateMode = ImportSettings.TUUpdateMode.Overwrite;
        }
        #endregion
    }
}
</code></pre></section>
</div>
<h2 id="see-also">See Also</h2>
<p><a href="creating_the_master_translation_memories.html">Creating the Master Translation Memories</a></p>
<p><a href="creating_a_log_file.html">Creating the Log File</a></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/RWS/studio-api-docs/blob/main/apiconcepts/translationmemory/importing_into_the_master_translation_memories.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h4>On this page</h4>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
