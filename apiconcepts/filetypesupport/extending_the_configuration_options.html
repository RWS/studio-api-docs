<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Extending the Configuration Options </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Extending the Configuration Options ">
    <meta name="generator" content="docfx 2.58.9.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <span class="glyphicon glyphicon-search search-icon"></span>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar-default">
          <div class="container hide-when-search">
            <div class="breadcrumb-container" id="breadcrumb">
              <ul class="breadcrumb col-md-10">
                <li></li>
              </ul>
            </div>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="extending-the-configuration-options">Extending the Configuration Options</h1>

<p>This chapter provides an example of how to enhance your file type plug-in with another configuration option.</p>
<h2 id="add-another-file-type-plug-in-option">Add Another File Type Plug-in Option</h2>
<p>Let us assume that the product code prefix may vary from file to file. In this case it makes sense to implement the product code string as an option that can be configured at runtime rather than hard-coding it in the application. This requires some additions to the filter settings, the control UI, and the file parser component.</p>
<h2 id="extend-the-file-type-settings">Extend the File Type Settings</h2>
<p>Before we can add the new option to the UI Control we first need to add it to the filter settings. The new setting should follow the same pattern as other settings we have added to the settings class - we will need to add a settings key, a default value, and an accessor property for the setting. We also need to update the <code>ResetToDefaults</code>, <code>PopulateFromSettingsBundle</code> and <code>SaveToSettingsBundle</code> methods to handle the new setting. See <strong>Putting It All Together</strong> for an example of how to do this.</p>
<h2 id="extend-the-ui-control">Extend the UI Control</h2>
<p>Extend the file type plug-in settings UI by adding a new text field called e.g. <code>txt_PrdCodePrefix</code>.</p>
<p><img src="images/SimpleFilterExtendedUI.jpg" alt="SimpleFilterExtendedUI"></p>
<p>Add a helper function that enables or disables the new text field depending on whether the <code>cb_LockPrdCodes</code> check box is checked or not:</p>
<div class="tabGroup" id="tabgroup_s8VMprhZIC">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_s8VMprhZIC_tabid-1" role="tab" aria-controls="tabpanel_s8VMprhZIC_tabid-1" data-tab="tabid-1" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_s8VMprhZIC_tabid-1" role="tabpanel" data-tab="tabid-1">
<pre><code class="lang-cs">private void txt_PrdCodePrefix_TextChanged(object sender, EventArgs e)
{
    _userSettings.PrdCodesPrefix = txt_PrdCodePrefix.Text;
}
</code></pre></section>
</div>
<div class="tabGroup" id="tabgroup_s8VMprhZIC-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_s8VMprhZIC-1_tabid-2" role="tab" aria-controls="tabpanel_s8VMprhZIC-1_tabid-2" data-tab="tabid-2" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_s8VMprhZIC-1_tabid-2" role="tabpanel" data-tab="tabid-2">
<pre><code class="lang-cs">public void UpdateControl()
{
    cb_LockPrdCodes.Checked = _userSettings.LockPrdCodes;
    txt_PrdCodePrefix.Text = _userSettings.PrdCodesPrefix;
}
</code></pre></section>
</div>
<h2 id="modify-the-file-parser">Modify the File Parser</h2>
<p>Last, you need to modify the file parser component, so that it uses the configurable product code prefix property rather than the hard-coded string. First, add a new global property to the file parser class:</p>
<div class="tabGroup" id="tabgroup_s8VMprhZIC-2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_s8VMprhZIC-2_tabid-3" role="tab" aria-controls="tabpanel_s8VMprhZIC-2_tabid-3" data-tab="tabid-3" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_s8VMprhZIC-2_tabid-3" role="tabpanel" data-tab="tabid-3">
<pre><code class="lang-cs">public string PrdCodesPrefix
{
    get;
    set;
}
</code></pre></section>
</div>
<p>In the <code>InitializeSettings</code> method you need to read this property from the user settings to initialize the file parser class. Here is the complete method with <code>PrdCodesPrefix</code> initialized from the user settings.</p>
<div class="tabGroup" id="tabgroup_s8VMprhZIC-3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_s8VMprhZIC-3_tabid-4" role="tab" aria-controls="tabpanel_s8VMprhZIC-3_tabid-4" data-tab="tabid-4" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_s8VMprhZIC-3_tabid-4" role="tabpanel" data-tab="tabid-4">
<pre><code class="lang-cs">public void InitializeSettings(Sdl.Core.Settings.ISettingsBundle settingsBundle, string configurationId)
{
    UserSettingsExtended userSettings = new UserSettingsExtended();
    userSettings.PopulateFromSettingsBundle(settingsBundle, configurationId);
    LockPrdCodes = userSettings.LockPrdCodes;
    PrdCodesPrefix = userSettings.PrdCodesPrefix;
}
</code></pre></section>
</div>
<p>In the ProcessLine() function you then need to change the <code>else if</code>condition from:</p>
<div class="tabGroup" id="tabgroup_s8VMprhZIC-4">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_s8VMprhZIC-4_tabid-5" role="tab" aria-controls="tabpanel_s8VMprhZIC-4_tabid-5" data-tab="tabid-5" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_s8VMprhZIC-4_tabid-5" role="tabpanel" data-tab="tabid-5">
<pre><code class="lang-cs"> else if (sLine.StartsWith(&quot;Prd-Code&quot;) &amp;&amp; LockPrdCodes==true) 
</code></pre></section>
</div>
<p>to:</p>
<div class="tabGroup" id="tabgroup_s8VMprhZIC-5">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_s8VMprhZIC-5_tabid-6" role="tab" aria-controls="tabpanel_s8VMprhZIC-5_tabid-6" data-tab="tabid-6" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_s8VMprhZIC-5_tabid-6" role="tabpanel" data-tab="tabid-6">
<pre><code class="lang-cs">else if (sLine.StartsWith(PrdCodePrefix) &amp;&amp; LockPrdCodes==true)
</code></pre></section>
</div>
<p>After rebuilding your project, the file type plug-in should implement the second configuration option and apply it during parsing.</p>
<h2 id="putting-it-all-together">Putting It All Together</h2>
<p>Your extended <code>UserSettings</code> class should now look as shown below:</p>
<div class="tabGroup" id="tabgroup_s8VMprhZIC-6">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_s8VMprhZIC-6_tabid-7" role="tab" aria-controls="tabpanel_s8VMprhZIC-6_tabid-7" data-tab="tabid-7" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_s8VMprhZIC-6_tabid-7" role="tabpanel" data-tab="tabid-7">
<pre><code class="lang-cs">using Sdl.FileTypeSupport.Framework.Core.Settings;
using Sdl.Core.Settings;

namespace Sdk.FileTypeSupport.Samples.SimpleText
{
    /// &lt;summary&gt;
    /// This class is used to actually store the settings to the settings bundle, which
    /// is physically saved in an *.sdlproj or in an *.sdltpl file.
    /// &lt;/summary&gt;
    public class UserSettingsExtended : FileTypeSettingsBase
    {
        #region &quot;Properties&quot;
        private const string SettingsLockPrdCodes = &quot;LockPrdCodes&quot;;
        private const string SettingsPrdCodesPrefix = &quot;PrdCodesPrefix&quot;;

        private const bool DefaultLockPrdCodes = true;
        private const string DefaultPrdCodePrefix = &quot;Prd-Code&quot;;

        private bool _lockPrdCodes;
        private string _prdCodesPrefix;

        public bool LockPrdCodes
        {
            get { return _lockPrdCodes; }
            set
            {
                _lockPrdCodes = value;
                OnPropertyChanged(&quot;LockPrdCodes&quot;);
            }
        }

        public string PrdCodesPrefix
        {
            get { return _prdCodesPrefix; }
            set
            {
                _prdCodesPrefix = value;
                OnPropertyChanged(&quot;PrdCodesPrefix&quot;);
            }
        }
        #endregion

        #region &quot;Constructor&quot;
        public UserSettingsExtended()
        {
            ResetToDefaults();
        }
        #endregion

        /// &lt;summary&gt;
        /// Define the default value, which is Enabled, as the product code strings should
        /// not be exposed to translation by default.
        /// &lt;/summary&gt;
        #region &quot;ResetToDefaults&quot;
        public override sealed void ResetToDefaults()
        {
            LockPrdCodes = DefaultLockPrdCodes;
            PrdCodesPrefix = DefaultPrdCodePrefix;
        }
        #endregion

        /// &lt;summary&gt;
        /// This method is used to load the setting from the settings bundle,
        /// which is physically stored in an XML-compliant *.sdlproj or *.sdltpl file.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;settingsBundle&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;configurationId&quot;&gt;&lt;/param&gt;
        #region &quot;PopulateFromSettingsBundle&quot;
        public override void PopulateFromSettingsBundle(ISettingsBundle settingsBundle, string filterDefinitionId)
        {
            ISettingsGroup settingsGroup = settingsBundle.GetSettingsGroup(filterDefinitionId);
            LockPrdCodes = GetSettingFromSettingsGroup(settingsGroup, SettingsLockPrdCodes, DefaultLockPrdCodes);
            PrdCodesPrefix = GetSettingFromSettingsGroup(settingsGroup, SettingsPrdCodesPrefix, DefaultPrdCodePrefix);
        }
        #endregion

        /// &lt;summary&gt;
        /// This method is used to store the settings as configured in the plug-in UI
        /// in the settings bundle, which means that the settings are physically written
        /// into the XML-compliant *.sdlproj or *.sdltpl file.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;settingsBundle&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;configurationId&quot;&gt;&lt;/param&gt;
        #region &quot;SaveToSettingsBundle&quot;
        public override void SaveToSettingsBundle(ISettingsBundle settingsBundle, string filterDefinitionId)
        {
            ISettingsGroup settingsGroup = settingsBundle.GetSettingsGroup(filterDefinitionId);
            UpdateSettingInSettingsGroup(settingsGroup, SettingsLockPrdCodes, LockPrdCodes, DefaultLockPrdCodes);
            UpdateSettingInSettingsGroup(settingsGroup, SettingsPrdCodesPrefix, PrdCodesPrefix, DefaultPrdCodePrefix);
        }
        #endregion
    }
}
</code></pre></section>
</div>
<p>Your extended <code>SettingsUI</code> class should now look as shown below:</p>
<div class="tabGroup" id="tabgroup_s8VMprhZIC-7">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_s8VMprhZIC-7_tabid-8" role="tab" aria-controls="tabpanel_s8VMprhZIC-7_tabid-8" data-tab="tabid-8" tabindex="0" aria-selected="true">C#</a>
</li>
</ul>
<section id="tabpanel_s8VMprhZIC-7_tabid-8" role="tabpanel" data-tab="tabid-8">
<pre><code class="lang-cs">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Data;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using Sdl.FileTypeSupport.Framework.Core.Settings;

namespace Sdk.FileTypeSupport.Samples.SimpleText.WinUI
{
    /// &lt;summary&gt;
    /// Implements the user interface for the file type definition.
    /// &lt;/summary&gt;
    #region &quot;ClassDeclaration&quot;
    public partial class SettingsUIExtended : UserControl, IFileTypeSettingsAware&lt;UserSettingsExtended&gt;
    #endregion
    {
        /// &lt;summary&gt;
        /// Create a settings object based on the UserSettings class. 
        /// &lt;/summary&gt;
        #region &quot;SettingsObject&quot;
        private UserSettingsExtended _userSettings;
        #endregion

        /// &lt;summary&gt;
        /// Initalize the user interface control by setting it to the
        /// setting value stored in the settings bundle.
        /// &lt;/summary&gt;
        #region &quot;Initialize&quot;
        public SettingsUIExtended()
        {
            InitializeComponent();
        }
        #endregion


        /// &lt;summary&gt;
        /// Reset the user interface control to its default value, which is
        /// checked, i.e. the product lock option should be enabled
        /// by default.
        /// &lt;/summary&gt;
        #region &quot;UpdateControl&quot;
        public void UpdateControl()
        {
            cb_LockPrdCodes.Checked = _userSettings.LockPrdCodes;
            txt_PrdCodePrefix.Text = _userSettings.PrdCodesPrefix;
        }
        #endregion

        /// &lt;summary&gt;
        /// Save the settings based on the value of the the check box.
        /// The setting is saved through the UserSettings class, which
        /// handles the plug-in settings bundle.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        #region &quot;SaveSetting&quot;
        private void cb_LockPrdCodes_CheckedChanged(object sender, EventArgs e)
        {
            _userSettings.LockPrdCodes = cb_LockPrdCodes.Checked;

            if (cb_LockPrdCodes.Checked)
                txt_PrdCodePrefix.Enabled = true;
            else
                txt_PrdCodePrefix.Enabled = false;
        }
        #endregion

        #region &quot;SaveTextBox&quot;
        private void txt_PrdCodePrefix_TextChanged(object sender, EventArgs e)
        {
            _userSettings.PrdCodesPrefix = txt_PrdCodePrefix.Text;
        }
        #endregion

        /// &lt;summary&gt;
        /// Implementation of &lt;code&gt;IFileTypeSettingsAware&lt;/code&gt; allowing the Filter Framework
        /// to pass through the user settings so that we can initialize the UI.
        /// &lt;/summary&gt;
        #region &quot;ApplySettings&quot;
        public UserSettingsExtended Settings
        {
            get
            {
                return _userSettings;
            }
            set
            {
                _userSettings = value;
                UpdateControl();
            }
        }
        #endregion
    }
}
</code></pre></section>
</div>
<div class="NOTE"><h5>Note</h5><p>This content may be out-of-date. To check the latest information on this topic, inspect the libraries using the Visual Studio Object Browser.</p>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/RWS/studio-api-docs/blob/main/apiconcepts/filetypesupport/extending_the_configuration_options.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h4>On this page</h4>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
