<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Processing Files and Application Logic </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Processing Files and Application Logic ">
    <meta name="generator" content="docfx 2.58.9.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <span class="glyphicon glyphicon-search search-icon"></span>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar-default">
          <div class="container hide-when-search">
            <div class="breadcrumb-container" id="breadcrumb">
              <ul class="breadcrumb col-md-10">
                <li></li>
              </ul>
            </div>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="processing-files-and-application-logic">Processing Files and Application Logic</h1>

<p>Implement the functionality that changes the status of document segments.</p>
<h2 id="how-to-trigger-the-batch-task">How to trigger the batch task</h2>
<p>Go back to the <strong>MyCustomBatchTask.cs</strong> class. This class is triggered when you decide to run the batch task. This class inherits from the following abstract class:</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp_tabid-1" role="tab" aria-controls="tabpanel_WE6RZvERMp_tabid-1" data-tab="tabid-1" tabindex="0" aria-selected="true">The Abstract Task Class</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp_tabid-1" role="tabpanel" data-tab="tabid-1">
<pre><code class="lang-csharp" name="MyCustomBatchTask" title="The Abstract Task Class">// A batch task plug-in needs to implement the AbstractFileContentProcessingAutomaticTask class
public class MyCustomBatchTask : AbstractFileContentProcessingAutomaticTask
</code></pre></section>
</div>
<p>Declare a member that stores the plug-in settings, as well as a string variable that is used to construct the XML stream for the task report content:</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-1_tabid-2" role="tab" aria-controls="tabpanel_WE6RZvERMp-1_tabid-2" data-tab="tabid-2" tabindex="0" aria-selected="true">The Task Settings</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-1_tabid-2" role="tabpanel" data-tab="tabid-2">
<pre><code class="lang-csharp" name="MyCustomBatchTask" title="The Task Settings">// These variables store the plug-in settings,
// the report string content
// and the language direction
private MyCustomBatchTaskSettings _settings;
private string _reportContent;
</code></pre></section>
</div>
<p>Initialise the task settings object and start constructing the report XML string by adding the root element. The root element should contain the selected confirmation level value in an attribute:</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-2_tabid-3" role="tab" aria-controls="tabpanel_WE6RZvERMp-2_tabid-3" data-tab="tabid-3" tabindex="0" aria-selected="true">Report XML String</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-2_tabid-3" role="tabpanel" data-tab="tabid-3">
<pre><code class="lang-csharp" name="MyCustomBatchTask" title="Report XML String">// The task is initialized
// This means that the settings are retrieved,
// and we start constructing the report content string
protected override void OnInitializeTask()
{
    _settings = GetSetting&lt;MyCustomBatchTaskSettings&gt;();
    _reportContent +=&quot;&lt;report segmentStatus=&#39;&quot; + ((ConfirmationLevel)_settings.ConfirmationLevelSetting).ToString() + &quot;&#39;&gt;&quot;;
}
</code></pre></section>
</div>
<h2 id="how-to-process-the-sdlxliff-file">How to process the SDLXliff file</h2>
<p>You can programmatically access the file that is currently processed through the following member. In a &quot;Hello World&quot;-type implementation you could output the name and path of the processed file.</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-3_tabid-4" role="tab" aria-controls="tabpanel_WE6RZvERMp-3_tabid-4" data-tab="tabid-4" tabindex="0" aria-selected="true">Configuring the Converter</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-3_tabid-4" role="tabpanel" data-tab="tabid-4">
<pre><code class="lang-csharp" name="MyCustomBatchTask" title="Configuring the Converter">// Here we continue constructing the report string.
// Also we trigger the actual task by creating a FileReader object
// to which we pass the settings and the SDLXliff file name
protected override void ConfigureConverter(ProjectFile projectFile, IMultiFileConverter multiFileConverter)
{
    // We output each file name in the report
    // and the date/time at which processing started
    _reportContent += &quot;&lt;file&gt;&quot;;
    _reportContent += &quot;&lt;fileName&gt;&quot; + projectFile.Name + &quot;&lt;/fileName&gt;&quot;;
    _reportContent += &quot;&lt;language&gt;&quot; + projectFile.Language.ToString() + &quot;&lt;/language&gt;&quot;;
    _reportContent += &quot;&lt;processTime&gt;&quot; + DateTime.Now.ToString() + &quot;&lt;/processTime&gt;&quot;;
                
    // We initialize the class that performs the actual work
    FileReader _task = new FileReader(_settings, projectFile.LocalFilePath);
    multiFileConverter.AddBilingualProcessor(_task);
    multiFileConverter.Parse();
    _reportContent += &quot;&lt;/file&gt;&quot;;
}
</code></pre></section>
</div>
<p>As SDLXliff is an XML-compliant file type, you could  process it using the standard XML API. However, we recommend that you use the Trados Studio Bilingual API to process the file. This way, we add a new class to our project called <strong>FileReader.cs</strong>.</p>
<p>The <strong>FileReader.cs</strong> class needs to reference the following libraries:</p>
<pre><code class="lang-cs">using Sdl.Core.Globalization
using Sdl.FileTypeSupport.Framework.BilingualApi
</code></pre><p>It also needs to inherit from the following abstract class:</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-4">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-4_tabid-5" role="tab" aria-controls="tabpanel_WE6RZvERMp-4_tabid-5" data-tab="tabid-5" tabindex="0" aria-selected="true">Abstract class to Implement</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-4_tabid-5" role="tabpanel" data-tab="tabid-5">
<pre><code class="lang-csharp" name="FileReader" title="Abstract class to Implement">// This class performs the actual work, it needs to inherit from the 
// AbstractBilingualContentProcessor class to process bilingual SDLXliff files
public class FileReader : AbstractBilingualContentProcessor
</code></pre></section>
</div>
<p>Add the following members to store the task settings, the file name and path of the SDLXliff file to be processed, and the text file name and path that is used to output the exported segments:</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-5">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-5_tabid-6" role="tab" aria-controls="tabpanel_WE6RZvERMp-5_tabid-6" data-tab="tabid-6" tabindex="0" aria-selected="true">The Required Variables</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-5_tabid-6" role="tabpanel" data-tab="tabid-6">
<pre><code class="lang-csharp" name="FileReader" title="The Required Variables">// Variables to retrieve the task settings
// as well as the SDLXliff file patch to process and
// the path of the TXT file that contains the exported content
private readonly MyCustomBatchTaskSettings _taskSettings;
private readonly string _inputFilePath;
private StreamWriter _outFile;
</code></pre></section>
</div>
<h2 id="how-to-output-the-segment-content-to-a-text-filetitle">How to output the segment content to a text file</h2>
<p>With the following member we start by creating the text output file. This file is created in the same folder as the corresponding SDLXliff file and the *.txt extension is appended.</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-6">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-6_tabid-7" role="tab" aria-controls="tabpanel_WE6RZvERMp-6_tabid-7" data-tab="tabid-7" tabindex="0" aria-selected="true">Creating the Output File</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-6_tabid-7" role="tabpanel" data-tab="tabid-7">
<pre><code class="lang-csharp" name="FileReader" title="Creating the Output File">// We use this member to create the TXT export file
public override void SetFileProperties(IFileProperties fileInfo)
{
    _outFile = new StreamWriter(_inputFilePath + &quot;.txt&quot;);
}
</code></pre></section>
</div>
<p>In the next step, we loop through each paragraph unit of the SDLXliff file. We make sure to process only paragraph units that actually contain segments. When we encounter a paragraph unit that only contains structure tags (i.e. no localizable segments), we abort. When looping through the segment pairs, we write all segments with the selected confirmation status to the output text file:</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-7">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-7_tabid-8" role="tab" aria-controls="tabpanel_WE6RZvERMp-7_tabid-8" data-tab="tabid-8" tabindex="0" aria-selected="true">Outputing the Segment Pairs</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-7_tabid-8" role="tabpanel" data-tab="tabid-8">
<pre><code class="lang-csharp" name="FileReader" title="Outputing the Segment Pairs">// This member loops through all the segments, determines the segment status,
// and then outputs the content to the text file (if applicable)
public override void ProcessParagraphUnit(IParagraphUnit paragraphUnit)
{
    // Check if this paragraph actually contains segments 
    // If not, it is just a structure tag content, which is not processed
    if (paragraphUnit.IsStructure)
    {
        return;
    }

    // If the paragraph contains segment pairs, we loop through them,
    // determine their confirmation status, and depending on the status
    // output the text content to a TXT file
    foreach (ISegmentPair item in paragraphUnit.SegmentPairs)
    {
        int segmentStatus = _taskSettings.ConfirmationLevelSetting;
        if (item.Properties.ConfirmationLevel == (ConfirmationLevel)segmentStatus)
            _outFile.WriteLine(item.Source + &quot;;&quot; + item.Target);
    }
}
</code></pre></section>
</div>
<p>Once the file processing is done, we close the text output file.</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-8">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-8_tabid-9" role="tab" aria-controls="tabpanel_WE6RZvERMp-8_tabid-9" data-tab="tabid-9" tabindex="0" aria-selected="true">File is Complete</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-8_tabid-9" role="tabpanel" data-tab="tabid-9">
<pre><code class="lang-csharp" name="FileReader" title="File is Complete">// Here we close the TXT file
public override void FileComplete()
{           
    base.FileComplete();
    _outFile.Close();
}
</code></pre></section>
</div>
<p>The following member is required by the interface, although our implementation does not actually use it. The file complete member is called when processing a file is finished. However, as users could merge SDLXliff files, the following member must be present to determine what happens when the process has been completed for the entire merged file.</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-9">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-9_tabid-10" role="tab" aria-controls="tabpanel_WE6RZvERMp-9_tabid-10" data-tab="tabid-10" tabindex="0" aria-selected="true">Job is Complete</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-9_tabid-10" role="tabpanel" data-tab="tabid-10">
<pre><code class="lang-csharp" name="FileReader" title="Job is Complete">// Not really used in this implementation.
// Users can merge files and process them as one.
// If a single file is processed, the FileComlete member is invoked
// If all single files in a merged file are completed, then the Complete member is invoked
public override void Complete()
{
    base.Complete();
}
</code></pre></section>
</div>
<h2 id="how-to-complete-the-report-string">How to complete the Report String</h2>
<p>Go back to the <strong>MyCustomBatchTask.cs</strong> class. Here we do the following:</p>
<p>We continue constructing the XML string for the report by adding the name of the file currently processed, its target language and the date/time at which it was processed.</p>
<p>We create a <strong>FileReader</strong> object to which we pass the current SDLXliff file name, as well as our settings object:</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-10">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-10_tabid-11" role="tab" aria-controls="tabpanel_WE6RZvERMp-10_tabid-11" data-tab="tabid-11" tabindex="0" aria-selected="true">Configure converter</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-10_tabid-11" role="tabpanel" data-tab="tabid-11">
<pre><code class="lang-csharp" name="MyCustomBatchTask" title="Configure converter">// Here we continue constructing the report string.
// Also we trigger the actual task by creating a FileReader object
// to which we pass the settings and the SDLXliff file name
protected override void ConfigureConverter(ProjectFile projectFile, IMultiFileConverter multiFileConverter)
{
    // We output each file name in the report
    // and the date/time at which processing started
    _reportContent += &quot;&lt;file&gt;&quot;;
    _reportContent += &quot;&lt;fileName&gt;&quot; + projectFile.Name + &quot;&lt;/fileName&gt;&quot;;
    _reportContent += &quot;&lt;language&gt;&quot; + projectFile.Language.ToString() + &quot;&lt;/language&gt;&quot;;
    _reportContent += &quot;&lt;processTime&gt;&quot; + DateTime.Now.ToString() + &quot;&lt;/processTime&gt;&quot;;
                
    // We initialize the class that performs the actual work
    FileReader _task = new FileReader(_settings, projectFile.LocalFilePath);
    multiFileConverter.AddBilingualProcessor(_task);
    multiFileConverter.Parse();
    _reportContent += &quot;&lt;/file&gt;&quot;;
}
</code></pre></section>
</div>
<p>We complete the task by adding the closing XML report string with the closing root element. Then we generate the report using the <strong>CreateReport</strong> method implemented by the interface.</p>
<div class="tabGroup" id="tabgroup_WE6RZvERMp-11">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_WE6RZvERMp-11_tabid-12" role="tab" aria-controls="tabpanel_WE6RZvERMp-11_tabid-12" data-tab="tabid-12" tabindex="0" aria-selected="true">Complete task and report string</a>
</li>
</ul>
<section id="tabpanel_WE6RZvERMp-11_tabid-12" role="tabpanel" data-tab="tabid-12">
<pre><code class="lang-csharp" name="MyCustomBatchTask" title="Complete task and report string">// At the end of the task, we output the 
public override void TaskComplete()
{
    // We close the XML report string
    _reportContent += &quot;&lt;/report&gt;&quot;;
    // We call the method that actually creates the report in Studio
    // In this method we pass the report name, description, the actual
    // XML report content string and the optional language direction parameter.
    CreateReport(&quot;SDK Sample Task Report&quot;, &quot;Sample batch task plug-in report&quot;, _reportContent);
    
}
</code></pre></section>
</div>
<p>This method requires the report name, description and the XML string for the report content. You  may also add an optional language direction parameter. If this parameter is missing, the report will not be listed under the specific target language, but rather above all available target languages of the corresponding project.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/RWS/studio-api-docs/blob/main/apiconcepts/batchtasks/processing_files_and_application_logic.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h4>On this page</h4>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
